<a href="../index.html"><img src="../libraries/logo.png"></img></a>
<br><br>
<canvas id="canvas" width="500" height="500"></canvas><br>
<script>

	var canvas;
	var ctx;
	var paddle;
	var level;
	var ball;
	var direction;

	window.onload = function(){
		// Canvas
		canvas = document.getElementById("canvas");
		ctx=canvas.getContext("2d");
		// Key listeners
		document.addEventListener("keydown", keyDown);
		document.addEventListener("keyup", keyUp);
		// Objects
		paddle = new Paddle("black");
		level = new Level("grey");
		ball = new Ball("white");
		direction = [false, false];
		// Start game
		setInterval(game, 1000/100);
	}

	function Level(color){
		this.color = color;
		
		this.render = function(){
			ctx.fillStyle = this.color;
			ctx.fillRect(0, 0, canvas.width, canvas.height);
		}
	}

	function Paddle(color){
		this.color = color;
		this.width = 80;
		this.height = 10;
		this.speedK = 3;
		this.speed = 0;
		this.x = (canvas.width-this.width)/2;
		this.y = canvas.height - this.height - 5;

		this.render = function(){
			ctx.fillStyle = this.color;
			ctx.fillRect(this.x, this.y, this.width, this.height);
		}

		this.update = function(){
			if(direction[0] && !direction[1]){
				this.speed = this.speedK*-1;
			} else if(direction[1] && !direction[0]){
				this.speed = this.speedK*1;
			} else{
				this.speed = 0;
			}
			this.x += this.speed;
			if(this.x < 0){
				this.x = 0;
			} else if(this.x >= canvas.width - this.width){
				this.x = canvas.width - this.width - 1;
			}
		}
	}

	function Ball(color){
		this.color = color;
		this.size = 6;
		this.x = paddle.x + paddle.width/2 - this.size/2;
		this.y = paddle.y - this.size;
		this.speedK = 3;
		this.xSpeed = 0;
		this.ySpeed = 0;
		
		this.render = function(){
			ctx.fillStyle = this.color;
			ctx.fillRect(this.x, this.y, this.size, this.size);
		}

		this.shoot = function(){
			if(this.ySpeed == 0){
				this.calculateAngle();
			}
		}

		this.update = function(){

			if(this.ySpeed == 0){
				if(this.x < paddle.x){
					this.x = paddle.x;
				} else if(this.x >= paddle.x + paddle.width - this.size){
					this.x = paddle.x + paddle.width - this.size;
				}
			} else{
				this.x += this.xSpeed;
				this.y -= this.ySpeed;

				if(this.x < 0){
					this.x = 0;
					this.xSpeed *= -1;
				} else if(this.x >= canvas.width - this.size){
					this.x = canvas.width - this.size - 1;
					this.xSpeed *= -1;
				}

				if(this.y < 0){
					this.y = 0;
					this.ySpeed *= -1;
				} else if(this.y >= paddle.y - ball.size){
					this.collide();
				}
			}
		}

		this.collide = function(){
			if(this.x > paddle.x - this.size && this.x < paddle.x + paddle.width + this.size){
				this.y = paddle.y - ball.size - 1;
				this.calculateAngle();
			} else{
				initialize();
			}
		}

		// Paddle split into 8 segments. Angles will be in degrees:
			// (45, 30, 15, 0, 0, 15, 30, 45).
		this.calculateAngle = function(){
			var middlePos = this.x + this.size/2;
			if(middlePos < paddle.x + paddle.width/8){
				this.xSpeed = this.speedK*-Math.cos(Math.PI*0.25);
				this.ySpeed = -this.xSpeed;
			} else if(middlePos < paddle.x + 2*paddle.width/8){
				this.xSpeed = this.speedK*-Math.sin(Math.PI/6);
				this.ySpeed = this.speedK*Math.cos(Math.PI/6);
			} else if(middlePos < paddle.x + 3*paddle.width/8){
				this.xSpeed = this.speedK*-Math.sin(Math.PI/12);
				this.ySpeed = this.speedK*Math.cos(Math.PI/12);
			} else if(middlePos < paddle.x + 5*paddle.width/8){
				this.xSpeed = 0;
				this.ySpeed = this.speedK;
			} else if(middlePos < paddle.x + 6*paddle.width/8){
				this.xSpeed = this.speedK*Math.sin(Math.PI/12);
				this.ySpeed = this.speedK*Math.cos(Math.PI/12);
			} else if(middlePos < paddle.x + 7*paddle.width/8){
				this.xSpeed = this.speedK*Math.sin(Math.PI/6);
				this.ySpeed = this.speedK*Math.cos(Math.PI/6);
			} else{
				this.xSpeed = this.speedK*Math.cos(Math.PI*0.25);
				this.ySpeed = this.xSpeed;
			}
		}
	}

	function initialize(){
		ball.x = paddle.x + paddle.width/2 - ball.size/2;
		ball.y = paddle.y - ball.size;
		ball.xSpeed = 0;
		ball.ySpeed = 0;
	}

	function render(){
		level.render();
		paddle.render();
		ball.render();
	}

	function updateStates(){
		paddle.update();
		ball.update();
	}

	function game(){
		updateStates();
		render();
	}

	function keyDown(evt){
		switch(evt.keyCode){
			case 37: // left
				direction[0] = true;
				break;
			case 39: // right
				direction[1] = true;
				break;
			case 32: // space
				ball.shoot();
		}
	}

	function keyUp(evt){
		switch(evt.keyCode){
			case 37: // left
				direction[0] = false;
				break;
			case 39: // right
				direction[1] = false;
				break;
		}
	}
		
</script>
